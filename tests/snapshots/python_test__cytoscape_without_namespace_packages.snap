---
source: tests/python_test.rs
expression: output_without_ns
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dependency Graph - Cytoscape.js</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.33.1/cytoscape.min.js"></script>
    <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.5.0/cytoscape-dagre.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
        }

        #main-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        #controls {
            background: #f5f5f5;
            padding: 12px;
            border-bottom: 1px solid #ddd;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        #content-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        #filter-panel {
            width: 280px;
            background: #f9f9f9;
            border-right: 1px solid #ddd;
            padding: 15px;
            overflow-y: auto;
            transition: margin-left 0.3s ease;
            flex-shrink: 0;
        }

        #filter-panel.collapsed {
            margin-left: -280px;
        }

        #cy-container {
            flex: 1;
            position: relative;
            background: #ffffff;
        }

        #cy {
            width: 100%;
            height: 100%;
        }

        button {
            padding: 8px 16px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        button:hover {
            background: #e9e9e9;
        }

        button:active {
            background: #d9d9d9;
        }

        button.primary {
            background: #1976d2;
            color: white;
            border-color: #1976d2;
        }

        button.primary:hover {
            background: #1565c0;
        }

        #toggle-filters {
            font-size: 18px;
            padding: 8px 12px;
            font-weight: bold;
        }

        #info {
            font-size: 14px;
            color: #666;
            margin-left: auto;
        }

        .filter-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .filter-section:last-child {
            border-bottom: none;
        }

        .filter-section h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .filter-section label {
            display: block;
            margin: 8px 0;
            cursor: pointer;
            font-size: 13px;
        }

        .filter-section input[type="checkbox"] {
            margin-right: 6px;
        }

        .filter-section input[type="text"] {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 13px;
            box-sizing: border-box;
        }

        .filter-section small {
            display: block;
            margin-top: 4px;
            color: #666;
            font-size: 11px;
        }

        #distance-slider {
            width: 100%;
            margin: 8px 0;
        }

        #distance-display {
            text-align: center;
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .module-chips {
            min-height: 30px;
            margin-bottom: 8px;
        }

        .module-chip {
            display: inline-block;
            background: #1976d2;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            margin: 2px;
            font-size: 11px;
        }

        .module-chip .remove {
            margin-left: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .module-chip .remove:hover {
            color: #ffcccc;
        }

        .module-dropdown {
            position: relative;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 4px;
        }

        .module-dropdown input {
            position: sticky;
            top: 0;
            background: white;
            z-index: 1;
        }

        .module-list {
            max-height: 150px;
            overflow-y: auto;
        }

        .module-item {
            padding: 6px 8px;
            cursor: pointer;
            font-size: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .module-item:hover {
            background: #f5f5f5;
        }

        .small-btn {
            font-size: 12px;
            padding: 4px 8px;
            width: 100%;
        }

        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 10000;
            min-width: 150px;
        }

        .menu-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 13px;
            border-bottom: 1px solid #f0f0f0;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: #f5f5f5;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            font-size: 13px;
            z-index: 1000;
        }

        .legend-title {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 6px 0;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid #999;
        }
    </style>
</head>
<body>
    <div id="main-container">
        <div id="controls">
            <button id="toggle-filters" title="Toggle Filters">≡</button>
            <button onclick="fitGraph()">Fit to Screen</button>
            <button onclick="resetZoom()">Reset Zoom</button>
            <button onclick="centerGraph()">Center</button>
            <button onclick="exportPNG()">Export as PNG</button>
            <div id="info"></div>
        </div>

        <div id="content-container">
            <div id="filter-panel" class="collapsed">
                <div class="filter-section">
                    <h3>Display Options</h3>
                    <label><input type="checkbox" id="filter-orphans"> Show Orphan Nodes</label>
                    <label><input type="checkbox" id="filter-namespaces"> Show Namespace Packages</label>
                    <label><input type="checkbox" id="filter-highlighted-only"> Highlighted Only</label>
                </div>

                <div class="filter-section">
                    <h3>Distance Limit</h3>
                    <input type="range" id="distance-slider" min="0" max="10" step="1" value="0">
                    <div id="distance-display">All Distances</div>
                </div>

                <div class="filter-section">
                    <h3>Upstream Dependencies</h3>
                    <div id="upstream-selector">
                        <div class="module-chips" id="upstream-chips"></div>
                    </div>
                    <button id="add-upstream" class="small-btn">+ Add Module</button>
                </div>

                <div class="filter-section">
                    <h3>Downstream Dependencies</h3>
                    <div id="downstream-selector">
                        <div class="module-chips" id="downstream-chips"></div>
                    </div>
                    <button id="add-downstream" class="small-btn">+ Add Module</button>
                </div>

                <div class="filter-section">
                    <h3>Exclude Scripts</h3>
                    <input type="text" id="exclude-patterns" placeholder="*old*, test_*">
                    <small>Supports wildcards: *prefix, suffix*, *substring*</small>
                </div>

                <div class="filter-section">
                    <button id="reset-filters">Reset to Original</button>
                    <button id="apply-filters" class="primary">Apply Filters</button>
                </div>
            </div>

            <div id="cy-container">
                <div id="cy"></div>

                <div class="legend">
                    <div class="legend-title">Legend</div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #90caf9; border-radius: 50%;"></div>
                        <span>Module</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #a5d6a7;"></div>
                        <span>Script</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffcc80; clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);"></div>
                        <span>Namespace Package</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #bbdefb; border: 2px solid #1976d2;"></div>
                        <span>Highlighted</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== Filter Utility Functions =====

        // Pattern matching with wildcard support
        function matchesPattern(nodeName, pattern) {
            if (!pattern) return false;

            if (!pattern.includes('*')) {
                // No wildcard - check if pattern is substring
                return nodeName.includes(pattern);
            }

            if (pattern.startsWith('*') && pattern.endsWith('*')) {
                // *substring* - contains check
                return nodeName.includes(pattern.slice(1, -1));
            } else if (pattern.startsWith('*')) {
                // *suffix - endsWith check
                return nodeName.endsWith(pattern.slice(1));
            } else if (pattern.endsWith('*')) {
                // prefix* - startsWith check
                return nodeName.startsWith(pattern.slice(0, -1));
            }

            return false;
        }

        // Get all node data from Cytoscape
        function getAllNodes() {
            return cy.nodes().map(node => ({
                id: node.id(),
                data: node.data(),
                element: node
            }));
        }

        // Get all edges as source-target pairs
        function getAllEdges() {
            return cy.edges().map(edge => ({
                source: edge.source().id(),
                target: edge.target().id(),
                element: edge
            }));
        }

        // ===== Filter State Class =====

        class FilterState {
            constructor() {
                this.showOrphans = true;
                this.showNamespaces = true;
                this.excludePatterns = [];
                this.upstreamRoots = new Set();
                this.downstreamRoots = new Set();
                this.maxDistance = null;
                this.highlightedOnly = false;
            }

            reset() {
                this.showOrphans = true;
                this.showNamespaces = true;
                this.excludePatterns = [];
                this.upstreamRoots = new Set();
                this.downstreamRoots = new Set();
                this.maxDistance = null;
                this.highlightedOnly = false;
            }

            computeVisibleNodes() {
                let nodes = getAllNodes();
                const edges = getAllEdges();

                // 1. Filter orphans
                if (!this.showOrphans) {
                    nodes = nodes.filter(n => !n.data.is_orphan);
                }

                // 2. Filter namespace packages
                if (!this.showNamespaces) {
                    nodes = nodes.filter(n => n.data.type !== 'namespace');
                }

                // 3. Exclude scripts by pattern
                if (this.excludePatterns.length > 0) {
                    nodes = nodes.filter(n => {
                        return !this.excludePatterns.some(pattern =>
                            matchesPattern(n.id, pattern)
                        );
                    });
                }

                // 4. Distance-based filtering (upstream/downstream)
                if (this.upstreamRoots.size > 0 || this.downstreamRoots.size > 0) {
                    nodes = this.filterByDistance(nodes);
                }

                // 5. Highlighted only mode
                if (this.highlightedOnly) {
                    nodes = nodes.filter(n => n.data.highlighted);
                }

                return new Set(nodes.map(n => n.id));
            }

            filterByDistance(nodes) {
                const visible = new Set();

                // Process upstream roots
                for (const root of this.upstreamRoots) {
                    for (const node of nodes) {
                        const distances = node.data.all_distances || {};
                        const dist = distances[root];
                        if (dist !== undefined &&
                            (this.maxDistance === null || dist <= this.maxDistance)) {
                            visible.add(node.id);
                        }
                    }
                }

                // Process downstream roots - need to use reverse distances
                for (const root of this.downstreamRoots) {
                    for (const node of nodes) {
                        const distances = node.data.all_distances || {};
                        // Check if root can reach this node
                        const rootNode = cy.getElementById(root);
                        if (rootNode.length > 0) {
                            const rootDistances = rootNode.data('all_distances') || {};
                            const dist = rootDistances[node.id];
                            if (dist !== undefined &&
                                (this.maxDistance === null || dist <= this.maxDistance)) {
                                visible.add(node.id);
                            }
                        }
                    }
                }

                // If both upstream and downstream specified, take intersection
                if (this.upstreamRoots.size > 0 && this.downstreamRoots.size > 0) {
                    const upstreamNodes = new Set();
                    const downstreamNodes = new Set();

                    for (const root of this.upstreamRoots) {
                        for (const node of nodes) {
                            const distances = node.data.all_distances || {};
                            const dist = distances[root];
                            if (dist !== undefined &&
                                (this.maxDistance === null || dist <= this.maxDistance)) {
                                upstreamNodes.add(node.id);
                            }
                        }
                    }

                    for (const root of this.downstreamRoots) {
                        for (const node of nodes) {
                            const rootNode = cy.getElementById(root);
                            if (rootNode.length > 0) {
                                const rootDistances = rootNode.data('all_distances') || {};
                                const dist = rootDistances[node.id];
                                if (dist !== undefined &&
                                    (this.maxDistance === null || dist <= this.maxDistance)) {
                                    downstreamNodes.add(node.id);
                                }
                            }
                        }
                    }

                    // Return intersection
                    return nodes.filter(n => upstreamNodes.has(n.id) && downstreamNodes.has(n.id));
                }

                // Return union if only one type specified
                return nodes.filter(n => visible.has(n.id));
            }
        }

        // Create global filter state
        const filterState = new FilterState();

        // ===== Apply Filters Function =====

        function applyFilters() {
            const visibleIds = filterState.computeVisibleNodes();

            // Update node visibility
            cy.nodes().forEach(node => {
                if (visibleIds.has(node.id())) {
                    node.style('display', 'element');
                } else {
                    node.style('display', 'none');
                }
            });

            // Update edge visibility - only show edges where both endpoints are visible
            cy.edges().forEach(edge => {
                const sourceVisible = visibleIds.has(edge.source().id());
                const targetVisible = visibleIds.has(edge.target().id());

                if (sourceVisible && targetVisible) {
                    edge.style('display', 'element');
                } else {
                    edge.style('display', 'none');
                }
            });

            // Re-run layout with animation
            const layout = cy.layout({
                name: 'dagre',
                rankDir: 'LR',
                nodeSep: 50,
                rankSep: 100,
                padding: 30,
                animate: true,
                animationDuration: 500
            });

            layout.run();
        }

        // ===== Panel Toggle =====

        document.getElementById('toggle-filters').addEventListener('click', () => {
            const panel = document.getElementById('filter-panel');
            panel.classList.toggle('collapsed');

            // Resize graph after animation
            setTimeout(() => cy.resize(), 300);
        });

        // Initialize Cytoscape
        const cy = cytoscape({
            container: document.getElementById('cy'),

            elements: [
    { "data": { "id": "legacy_namespace.submodule.module", "label": "legacy_namespace.submodule.module", "type": "module"  , "is_orphan": false, "all_distances": { "legacy_namespace.submodule.module": 0 } } },
    { "data": { "id": "normal_pkg", "label": "normal_pkg", "type": "module"  , "is_orphan": false, "all_distances": { "normal_pkg": 0 } } },
    { "data": { "id": "normal_pkg.consumer", "label": "normal_pkg.consumer", "type": "module"  , "is_orphan": false, "all_distances": { "legacy_namespace.submodule.module": 1, "normal_pkg": 3, "normal_pkg.consumer": 0, "pep420_namespace.sub_a.module_a": 2, "pep420_namespace.sub_b.module_b": 1 } } },
    { "data": { "id": "pep420_namespace.sub_a.module_a", "label": "pep420_namespace.sub_a.module_a", "type": "module"  , "is_orphan": false, "all_distances": { "normal_pkg": 1, "pep420_namespace.sub_a.module_a": 0 } } },
    { "data": { "id": "pep420_namespace.sub_b.module_b", "label": "pep420_namespace.sub_b.module_b", "type": "module"  , "is_orphan": false, "all_distances": { "normal_pkg": 2, "pep420_namespace.sub_a.module_a": 1, "pep420_namespace.sub_b.module_b": 0 } } },
    { "data": { "source": "normal_pkg.consumer", "target": "legacy_namespace.submodule.module" } },
    { "data": { "source": "normal_pkg.consumer", "target": "pep420_namespace.sub_b.module_b" } },
    { "data": { "source": "pep420_namespace.sub_a.module_a", "target": "normal_pkg" } },
    { "data": { "source": "pep420_namespace.sub_b.module_b", "target": "pep420_namespace.sub_a.module_a" } }
            ],

            style: [
                {
                    selector: 'node',
                    style: {
                        'label': 'data(label)',
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'font-size': '12px',
                        'background-color': '#90caf9',
                        'border-width': 1,
                        'border-color': '#1976d2',
                        'width': 'label',
                        'height': 'label',
                        'padding': '10px',
                        'shape': 'ellipse',
                        'text-wrap': 'wrap',
                        'text-max-width': '150px'
                    }
                },
                {
                    selector: 'node[type="script"]',
                    style: {
                        'shape': 'rectangle',
                        'background-color': '#a5d6a7',
                        'border-color': '#388e3c'
                    }
                },
                {
                    selector: 'node[type="namespace"]',
                    style: {
                        'shape': 'hexagon',
                        'background-color': '#ffcc80',
                        'border-color': '#f57c00',
                        'border-style': 'dashed'
                    }
                },
                {
                    selector: 'node[highlighted]',
                    style: {
                        'background-color': '#bbdefb',
                        'border-width': 2,
                        'border-color': '#1976d2'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 2,
                        'line-color': '#999',
                        'target-arrow-color': '#999',
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier',
                        'arrow-scale': 1.2
                    }
                }
            ],

            layout: {
                name: 'dagre',
                rankDir: 'LR',
                nodeSep: 50,
                rankSep: 100,
                padding: 30
            }
        });

        // Update info on selection
        cy.on('select', 'node', function(evt) {
            const node = evt.target;
            const info = document.getElementById('info');
            info.textContent = `Selected: ${node.data('label')}`;
        });

        cy.on('unselect', 'node', function() {
            const info = document.getElementById('info');
            info.textContent = '';
        });

        // Control functions
        function fitGraph() {
            cy.fit(undefined, 50);
        }

        function resetZoom() {
            cy.zoom(1);
            cy.center();
        }

        function centerGraph() {
            cy.center();
        }

        function exportPNG() {
            const png = cy.png({ full: true, scale: 2 });
            const link = document.createElement('a');
            link.download = 'dependency-graph.png';
            link.href = png;
            link.click();
        }

        // ===== Module Selector Class =====

        class ModuleSelector {
            constructor(containerId, allModules, onChange) {
                this.container = document.getElementById(containerId);
                this.allModules = allModules;
                this.selected = new Set();
                this.onChange = onChange;
            }

            render() {
                const chips = Array.from(this.selected)
                    .sort()
                    .map(m => `<span class="module-chip">${m} <span class="remove" data-module="${m}">×</span></span>`)
                    .join('');
                this.container.innerHTML = chips;

                // Add remove handlers
                this.container.querySelectorAll('.remove').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.removeModule(btn.dataset.module);
                    });
                });
            }

            addModule(moduleId) {
                this.selected.add(moduleId);
                this.render();
                this.onChange(this.selected);
            }

            removeModule(moduleId) {
                this.selected.delete(moduleId);
                this.render();
                this.onChange(this.selected);
            }

            clear() {
                this.selected.clear();
                this.render();
            }
        }

        // ===== Initialize UI After Cytoscape is Ready =====

        // Get all module names for selectors
        const allModuleNames = cy.nodes().map(n => n.id()).sort();

        // Initialize module selectors
        const upstreamSelector = new ModuleSelector('upstream-chips', allModuleNames, (selected) => {
            filterState.upstreamRoots = selected;
        });

        const downstreamSelector = new ModuleSelector('downstream-chips', allModuleNames, (selected) => {
            filterState.downstreamRoots = selected;
        });

        upstreamSelector.render();
        downstreamSelector.render();

        // ===== Filter Control Event Handlers =====

        // Checkbox handlers
        document.getElementById('filter-orphans').addEventListener('change', (e) => {
            filterState.showOrphans = e.target.checked;
        });

        document.getElementById('filter-namespaces').addEventListener('change', (e) => {
            filterState.showNamespaces = e.target.checked;
        });

        document.getElementById('filter-highlighted-only').addEventListener('change', (e) => {
            filterState.highlightedOnly = e.target.checked;
        });

        // Distance slider with debounce
        let distanceTimeout;
        document.getElementById('distance-slider').addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            document.getElementById('distance-display').textContent =
                value === 0 ? 'All Distances' : `Distance ≤ ${value}`;

            clearTimeout(distanceTimeout);
            distanceTimeout = setTimeout(() => {
                filterState.maxDistance = value === 0 ? null : value;
            }, 300);
        });

        // Exclude patterns input with debounce
        let patternTimeout;
        document.getElementById('exclude-patterns').addEventListener('input', (e) => {
            clearTimeout(patternTimeout);
            patternTimeout = setTimeout(() => {
                const value = e.target.value.trim();
                if (value) {
                    filterState.excludePatterns = value.split(',').map(p => p.trim()).filter(p => p);
                } else {
                    filterState.excludePatterns = [];
                }
            }, 300);
        });

        // Add module buttons - show simple prompt for now
        document.getElementById('add-upstream').addEventListener('click', () => {
            const moduleName = prompt('Enter module name:');
            if (moduleName && cy.getElementById(moduleName).length > 0) {
                upstreamSelector.addModule(moduleName);
            } else if (moduleName) {
                alert('Module not found: ' + moduleName);
            }
        });

        document.getElementById('add-downstream').addEventListener('click', () => {
            const moduleName = prompt('Enter module name:');
            if (moduleName && cy.getElementById(moduleName).length > 0) {
                downstreamSelector.addModule(moduleName);
            } else if (moduleName) {
                alert('Module not found: ' + moduleName);
            }
        });

        // Reset filters button
        document.getElementById('reset-filters').addEventListener('click', () => {
            filterState.reset();
            upstreamSelector.clear();
            downstreamSelector.clear();

            // Reset UI controls
            document.getElementById('filter-orphans').checked = true;
            document.getElementById('filter-namespaces').checked = true;
            document.getElementById('filter-highlighted-only').checked = false;
            document.getElementById('distance-slider').value = 0;
            document.getElementById('distance-display').textContent = 'All Distances';
            document.getElementById('exclude-patterns').value = '';

            // Show all nodes and edges
            cy.elements().style('display', 'element');

            // Re-layout
            cy.layout({
                name: 'dagre',
                rankDir: 'LR',
                nodeSep: 50,
                rankSep: 100,
                padding: 30
            }).run();
        });

        // Apply filters button
        document.getElementById('apply-filters').addEventListener('click', () => {
            applyFilters();
        });

        // ===== Context Menu for Nodes =====

        let contextMenu = null;

        // Remove any existing context menu
        function removeContextMenu() {
            if (contextMenu) {
                contextMenu.remove();
                contextMenu = null;
            }
        }

        // Right-click on node
        cy.on('cxttap', 'node', function(event) {
            const node = event.target;
            const nodeId = node.id();

            removeContextMenu();

            // Create context menu
            contextMenu = document.createElement('div');
            contextMenu.className = 'context-menu';
            contextMenu.style.left = event.originalEvent.pageX + 'px';
            contextMenu.style.top = event.originalEvent.pageY + 'px';

            const isInUpstream = filterState.upstreamRoots.has(nodeId);
            const isInDownstream = filterState.downstreamRoots.has(nodeId);

            contextMenu.innerHTML = `
                <div class="menu-item" data-action="add-upstream"${isInUpstream ? ' style="opacity:0.5"' : ''}>Add to Upstream</div>
                <div class="menu-item" data-action="add-downstream"${isInDownstream ? ' style="opacity:0.5"' : ''}>Add to Downstream</div>
                ${isInUpstream ? '<div class="menu-item" data-action="remove-upstream">Remove from Upstream</div>' : ''}
                ${isInDownstream ? '<div class="menu-item" data-action="remove-downstream">Remove from Downstream</div>' : ''}
            `;

            document.body.appendChild(contextMenu);

            // Handle menu clicks
            contextMenu.addEventListener('click', (e) => {
                const action = e.target.dataset.action;

                if (action === 'add-upstream' && !isInUpstream) {
                    upstreamSelector.addModule(nodeId);
                } else if (action === 'add-downstream' && !isInDownstream) {
                    downstreamSelector.addModule(nodeId);
                } else if (action === 'remove-upstream') {
                    upstreamSelector.removeModule(nodeId);
                } else if (action === 'remove-downstream') {
                    downstreamSelector.removeModule(nodeId);
                }

                removeContextMenu();
            });

            // Remove menu on outside click
            setTimeout(() => {
                document.addEventListener('click', removeContextMenu, { once: true });
            }, 10);
        });

        // Initial fit
        setTimeout(() => {
            cy.fit(undefined, 50);
        }, 100);
    </script>
</body>
</html>
